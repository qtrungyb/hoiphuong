<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Thu Tiền Hội Phường</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --primary-dark: #2980b9;
            --success-color: #2ecc71;
            --success-dark: #27ae60;
            --danger-color: #e74c3c;
            --danger-dark: #c0392b;
            --warning-color: #f39c12;
            --warning-dark: #e67e22;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --gray-light: #e9ecef;
            --gray: #6c757d;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            padding: 15px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            z-index: 1;
        }
        
        h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            position: relative;
            z-index: 2;
        }
        
        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }
        
        .summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            flex: 1;
            min-width: 120px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 4px solid var(--primary-color);
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.12);
        }
        
        .summary-card h3 {
            font-size: 0.85rem;
            color: var(--dark-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .summary-card i {
            font-size: 1rem;
        }
        
        .summary-card p {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
        }
        
        th, td {
            padding: 14px 10px;
            text-align: center;
            border-bottom: 1px solid var(--gray-light);
        }
        
        th {
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        td {
            font-size: 0.85rem;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        .member-row {
            transition: all 0.3s ease;
        }
        
        .member-row:hover {
            transform: scale(1.01);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .status-paid {
            color: var(--success-color);
            font-weight: bold;
        }
        
        .status-unpaid {
            color: var(--danger-color);
            font-weight: bold;
        }
        
        .progress-container {
            width: 100%;
            background-color: var(--gray-light);
            border-radius: 10px;
            overflow: hidden;
            height: 14px;
            margin: 8px 0;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--success-color), var(--success-dark));
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, 0.2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.2) 75%,
                transparent 75%,
                transparent
            );
            z-index: 1;
            background-size: 20px 20px;
            animation: move 1s linear infinite;
            overflow: hidden;
        }
        
        @keyframes move {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 20px 20px;
            }
        }
        
        .progress-text {
            font-size: 0.75rem;
            text-align: center;
            margin-top: 5px;
            display: flex;
            justify-content: space-between;
            color: var(--gray);
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-around;
        }
        
        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .btn-edit {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-delete {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-add {
            background: linear-gradient(to right, #00b09b, #96c93d);
            color: white;
            padding: 14px 20px;
            font-size: 0.95rem;
            display: flex;
            margin: 0 auto 20px;
            width: 100%;
            max-width: 280px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 176, 155, 0.3);
        }
        
        .btn-reset {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
            color: white;
            padding: 14px 20px;
            font-size: 0.95rem;
            display: flex;
            margin: 0 auto 20px;
            width: 100%;
            max-width: 280px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(255, 65, 108, 0.3);
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            animation: modalFade 0.3s;
            position: relative;
        }
        
        @keyframes modalFade {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .modal-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
            transition: color 0.3s;
        }
        
        .close:hover {
            color: var(--danger-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--dark-color);
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border 0.3s, box-shadow 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .checkbox-item input {
            width: auto;
            margin-right: 8px;
            transform: scale(1.2);
        }
        
        .payment-history {
            margin-top: 20px;
            border-top: 1px solid var(--gray-light);
            padding-top: 20px;
        }
        
        .payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px dashed var(--gray-light);
        }
        
        .payment-item:last-child {
            border-bottom: none;
        }
        
        .payment-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 5px 8px;
            font-size: 0.7rem;
        }
        
        .btn-save {
            background: linear-gradient(to right, var(--primary-color), var(--primary-dark));
            color: white;
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            margin-top: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        
        .payment-method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .method-cash {
            background-color: #ffeaa7;
            color: #d35400;
        }
        
        .method-transfer {
            background-color: #a29bfe;
            color: #2d3436;
        }
        
        @media (max-width: 480px) {
            th, td {
                padding: 12px 8px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn {
                padding: 10px;
                font-size: 0.7rem;
            }
            
            .summary-card {
                min-width: calc(50% - 10px);
            }
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--gray-light);
        }
        
        .payment-date {
            font-size: 0.75rem;
            color: var(--gray);
            margin-top: 3px;
        }
        
        /* Màu sắc cho từng thành viên */
        .color-1 { background-color: rgba(106, 176, 255, 0.2); }
        .color-2 { background-color: rgba(255, 168, 106, 0.2); }
        .color-3 { background-color: rgba(106, 255, 168, 0.2); }
        .color-4 { background-color: rgba(255, 106, 199, 0.2); }
        .color-5 { background-color: rgba(168, 106, 255, 0.2); }
        .color-6 { background-color: rgba(255, 214, 106, 0.2); }
        .color-7 { background-color: rgba(106, 255, 229, 0.2); }
        .color-8 { background-color: rgba(255, 106, 106, 0.2); }
        .color-9 { background-color: rgba(178, 255, 106, 0.2); }
        .color-10 { background-color: rgba(106, 199, 255, 0.2); }
        
        .color-border-1 { border-left: 4px solid #6ab0ff; }
        .color-border-2 { border-left: 4px solid #ffa86a; }
        .color-border-3 { border-left: 4px solid #6affa8; }
        .color-border-4 { border-left: 4px solid #ff6ac7; }
        .color-border-5 { border-left: 4px solid #a86aff; }
        .color-border-6 { border-left: 4px solid #ffd66a; }
        .color-border-7 { border-left: 4px solid #6affe5; }
        .color-border-8 { border-left: 4px solid #ff6a6a; }
        .color-border-9 { border-left: 4px solid #b2ff6a; }
        .color-border-10 { border-left: 4px solid #6ac7ff; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-hand-holding-usd"></i>THU TIỀN HỘI PHƯỜNG</h1>
        </header>
        <div class="summary">
            <div class="summary-card">
                <h3><i class="fas fa-users"></i> Tổng số người</h3>
                <p id="total-people">10</p>
            </div>
            <div class="summary-card">
                <h3><i class="fas fa-check-circle"></i> Đã nộp đủ</h3>
                <p id="paid-full">0</p>
            </div>
            <div class="summary-card">
                <h3><i class="fas fa-money-bill-wave"></i> Tổng tiền đã thu</h3>
                <p id="total-collected">0 VNĐ</p>
            </div>
        </div>
        
        <button class="btn btn-add" id="add-member-btn">
            <i class="fas fa-plus-circle"></i> Thêm người nộp tiền
        </button>
        
        <button class="btn btn-reset" id="reset-data-btn">
            <i class="fas fa-trash-alt"></i> Xóa toàn bộ dữ liệu
        </button>
        
        <div class="table-container">
            <table id="payment-table">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Tên</th>
                        <th>Số tiền</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Modal thêm/sửa -->
    <div id="member-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">
                    <i class="fas fa-user-plus"></i> Thêm người
                </h2>
                <span class="close">&times;</span>
            </div>
            <form id="member-form">
                <input type="hidden" id="member-id">
                
                <div class="form-group">
                    <label for="member-name"><i class="fas fa-user"></i> Họ và tên</label>
                    <input type="text" id="member-name" required placeholder="Nhập họ và tên">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-money-check"></i> Hình thức nộp</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="cash" value="cash">
                            <label for="cash">Tiền mặt</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="transfer" value="transfer">
                            <label for="transfer">Chuyển khoản</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="payment-date"><i class="fas fa-calendar-alt"></i> Ngày nộp</label>
                    <input type="date" id="payment-date">
                </div>
                
                <div class="form-group">
                    <label for="payment-amount"><i class="fas fa-coins"></i> Số tiền nộp (VNĐ)</label>
                    <input type="number" id="payment-amount" min="0" max="2000000" placeholder="Nhập số tiền">
                </div>
                
                <button type="button" class="btn btn-add" id="add-payment-btn">
                    <i class="fas fa-plus"></i> Thêm lần nộp
                </button>
                
                <div class="payment-history">
                    <h3><i class="fas fa-history"></i> Lịch sử nộp tiền</h3>
                    <div id="payment-list">
                        <!-- Danh sách các lần nộp sẽ được thêm ở đây -->
                    </div>
                </div>
                
                <button type="submit" class="btn btn-save">
                    <i class="fas fa-save"></i> Lưu thông tin
                </button>
            </form>
        </div>
    </div>

    <script>
        // Dữ liệu mẫu
        let members = [
            { id: 1, name: "Trung", payments: [{amount: 500000, method: "cash", date: "2023-10-01"}] },
            { id: 2, name: "Chị An", payments: [{amount: 1000000, method: "transfer", date: "2023-10-02"}] },
            { id: 3, name: "Vịnh", payments: [{amount: 2000000, method: "cash", date: "2023-10-03"}] },
            { id: 4, name: "Anh Tưởng", payments: [] },
            { id: 5, name: "Anh Dũng", payments: [{amount: 1500000, method: "transfer", date: "2023-10-05"}] },
            { id: 6, name: "Thiện", payments: [] },
            { id: 7, name: "Khương", payments: [{amount: 500000, method: "cash", date: "2023-10-07"}] },
            { id: 8, name: "Dương", payments: [{amount: 2000000, method: "transfer", date: "2023-10-08"}] },
            { id: 9, name: "Chị An", payments: [] },
            { id: 10, name: "Lâm", payments: [{amount: 1000000, method: "cash", date: "2023-10-10"}] }
        ];

        // Lưu dữ liệu vào localStorage
        function saveData() {
            localStorage.setItem('paymentMembers', JSON.stringify(members));
        }

        // Tải dữ liệu từ localStorage
        function loadData() {
            const savedData = localStorage.getItem('paymentMembers');
            if (savedData) {
                members = JSON.parse(savedData);
            }
        }

        // Hiển thị danh sách thành viên
        function renderTable() {
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = '';
            
            let totalCollected = 0;
            let paidFullCount = 0;
            
            if (members.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="empty-state">
                            <i class="fas fa-users-slash"></i>
                            <p>Chưa có người nộp tiền nào</p>
                        </td>
                    </tr>
                `;
            } else {
                members.forEach((member, index) => {
                    const totalPaid = member.payments.reduce((sum, payment) => sum + payment.amount, 0);
                    const progressPercent = Math.min((totalPaid / 2000000) * 100, 100);
                    const colorIndex = (member.id % 10) + 1;
                    
                    const row = document.createElement('tr');
                    row.className = `member-row color-${colorIndex} color-border-${colorIndex}`;
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${member.name}</td>
                        <td>
                            <div class="progress-container">
                                <div class="progress-bar" style="width: ${progressPercent}%"></div>
                            </div>
                            <div class="progress-text">
                                <span>${formatCurrency(totalPaid)} VNĐ</span>
                                <span>${formatCurrency(2000000)} VNĐ</span>
                            </div>
                            ${totalPaid >= 2000000 ? 
                                '<div class="status-paid"><i class="fas fa-check-circle"></i> Đã nộp đủ</div>' : 
                                `<div class="status-unpaid"><i class="fas fa-clock"></i> Còn ${formatCurrency(2000000 - totalPaid)} VNĐ</div>`
                            }
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-edit" data-id="${member.id}">
                                    <i class="fas fa-edit"></i> Sửa
                                </button>
                                <button class="btn btn-delete" data-id="${member.id}">
                                    <i class="fas fa-trash-alt"></i> Xóa
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                    
                    totalCollected += totalPaid;
                    if (totalPaid >= 2000000) {
                        paidFullCount++;
                    }
                });
            }
            
            // Cập nhật tổng số tiền
            document.getElementById('total-collected').textContent = formatCurrency(totalCollected) + ' VNĐ';
            document.getElementById('paid-full').textContent = paidFullCount;
            document.getElementById('total-people').textContent = members.length;
        }

        // Định dạng tiền tệ
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN').format(amount);
        }

        // Hiển thị modal
        function showModal(memberId = null) {
            const modal = document.getElementById('member-modal');
            const modalTitle = document.getElementById('modal-title');
            const form = document.getElementById('member-form');
            const paymentList = document.getElementById('payment-list');
            
            // Reset form
            form.reset();
            paymentList.innerHTML = '';
            
            if (memberId) {
                // Chế độ sửa
                modalTitle.innerHTML = '<i class="fas fa-user-edit"></i> Sửa thông tin nộp tiền';
                const member = members.find(m => m.id === memberId);
                
                document.getElementById('member-id').value = member.id;
                document.getElementById('member-name').value = member.name;
                
                // Hiển thị lịch sử nộp tiền
                member.payments.forEach((payment, index) => {
                    addPaymentToList(payment, index);
                });
            } else {
                // Chế độ thêm
                modalTitle.innerHTML = '<i class="fas fa-user-plus"></i> Thêm người nộp tiền';
            }
            
            modal.style.display = 'block';
        }

        // Ẩn modal
        function hideModal() {
            document.getElementById('member-modal').style.display = 'none';
        }

        // Thêm khoản thanh toán vào danh sách
        function addPaymentToList(payment, index) {
            const paymentList = document.getElementById('payment-list');
            const paymentItem = document.createElement('div');
            paymentItem.className = 'payment-item';
            paymentItem.innerHTML = `
                <div>
                    <strong>${formatCurrency(payment.amount)} VNĐ</strong>
                    <span class="payment-method method-${payment.method}">
                        ${payment.method === 'cash' ? 'Tiền mặt' : 'Chuyển khoản'}
                    </span>
                    <div class="payment-date">${payment.date}</div>
                </div>
                <div class="payment-actions">
                    <button type="button" class="btn btn-delete btn-small delete-payment" data-index="${index}">
                        <i class="fas fa-trash"></i> Xóa
                    </button>
                </div>
            `;
            paymentList.appendChild(paymentItem);
        }

        // Xử lý sự kiện khi trang được tải
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            renderTable();
            
            // Sự kiện nút thêm thành viên
            document.getElementById('add-member-btn').addEventListener('click', function() {
                showModal();
            });
            
            // Sự kiện nút xóa toàn bộ dữ liệu
            document.getElementById('reset-data-btn').addEventListener('click', function() {
                if (confirm('Bạn có chắc chắn muốn xóa toàn bộ dữ liệu? Hành động này sẽ xóa tất cả thông tin thu tiền và không thể hoàn tác.')) {
                    members = [];
                    saveData();
                    renderTable();
                }
            });
            
            // Sự kiện đóng modal
            document.querySelector('.close').addEventListener('click', hideModal);
            
            // Đóng modal khi click bên ngoài
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('member-modal');
                if (event.target === modal) {
                    hideModal();
                }
            });
            
            // Sự kiện thêm khoản thanh toán
            document.getElementById('add-payment-btn').addEventListener('click', function() {
                const amount = parseInt(document.getElementById('payment-amount').value) || 0;
                const cashChecked = document.getElementById('cash').checked;
                const transferChecked = document.getElementById('transfer').checked;
                const date = document.getElementById('payment-date').value;
                
                if (amount <= 0) {
                    alert('Vui lòng nhập số tiền hợp lệ');
                    return;
                }
                
                if (!cashChecked && !transferChecked) {
                    alert('Vui lòng chọn hình thức nộp');
                    return;
                }
                
                if (!date) {
                    alert('Vui lòng chọn ngày nộp');
                    return;
                }
                
                const payment = {
                    amount: amount,
                    method: cashChecked ? 'cash' : 'transfer',
                    date: date
                };
                
                addPaymentToList(payment, document.getElementById('payment-list').children.length);
                
                // Reset form nhập thanh toán
                document.getElementById('payment-amount').value = '';
                document.getElementById('cash').checked = false;
                document.getElementById('transfer').checked = false;
                document.getElementById('payment-date').value = '';
            });
            
            // Sự kiện xóa khoản thanh toán
            document.getElementById('payment-list').addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-payment') || 
                    e.target.parentElement.classList.contains('delete-payment')) {
                    
                    const deleteBtn = e.target.classList.contains('delete-payment') ? 
                        e.target : e.target.parentElement;
                    deleteBtn.closest('.payment-item').remove();
                }
            });
            
            // Sự kiện gửi form
            document.getElementById('member-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const memberId = document.getElementById('member-id').value;
                const name = document.getElementById('member-name').value;
                const paymentItems = document.getElementById('payment-list').children;
                
                // Thu thập các khoản thanh toán từ danh sách
                const payments = [];
                for (let i = 0; i < paymentItems.length; i++) {
                    const item = paymentItems[i];
                    const amountText = item.querySelector('strong').textContent;
                    const amount = parseInt(amountText.replace(/[^\d]/g, ''));
                    const methodClass = item.querySelector('.payment-method').classList[1];
                    const method = methodClass.includes('cash') ? 'cash' : 'transfer';
                    const date = item.querySelector('.payment-date').textContent;
                    
                    payments.push({ amount, method, date });
                }
                
                if (memberId) {
                    // Cập nhật thành viên
                    const memberIndex = members.findIndex(m => m.id === parseInt(memberId));
                    if (memberIndex !== -1) {
                        members[memberIndex].name = name;
                        members[memberIndex].payments = payments;
                    }
                } else {
                    // Thêm thành viên mới
                    const newId = members.length > 0 ? Math.max(...members.map(m => m.id)) + 1 : 1;
                    members.push({
                        id: newId,
                        name: name,
                        payments: payments
                    });
                }
                
                saveData();
                renderTable();
                hideModal();
            });
            
            // Sự kiện sửa/xóa thành viên
            document.getElementById('table-body').addEventListener('click', function(e) {
                if (e.target.classList.contains('btn-edit') || 
                    e.target.parentElement.classList.contains('btn-edit')) {
                    
                    const editBtn = e.target.classList.contains('btn-edit') ? 
                        e.target : e.target.parentElement;
                    const memberId = parseInt(editBtn.getAttribute('data-id'));
                    showModal(memberId);
                } else if (e.target.classList.contains('btn-delete') || 
                    e.target.parentElement.classList.contains('btn-delete')) {
                    
                    if (confirm('Bạn có chắc chắn muốn xóa người này?')) {
                        const deleteBtn = e.target.classList.contains('btn-delete') ? 
                            e.target : e.target.parentElement;
                        const memberId = parseInt(deleteBtn.getAttribute('data-id'));
                        members = members.filter(m => m.id !== memberId);
                        saveData();
                        renderTable();
                    }
                }
            });
        });
    </script>
</body>
</html>
